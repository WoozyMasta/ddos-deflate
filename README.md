# DDoS Deflate
Форк скрипта DDoS Deflate http://deflate.medialayer.com/ с фиксами и улучшением  функционала

**Автор:** Zaf <zaf@vsnl.com> (Copyright (C) 2005)

**Поддержка:** Maxim Levchenko <kagbe.leviy@gmail.com>

## О скрипте

(D) DoS Deflate - это легкий сценарий оболочки bash, предназначенный для помощи в блокировании атаки на отказ в обслуживании. Он использует приведенную ниже команду для создания списка IP-адресов, подключенных к серверу, вместе с их общим количеством подключений. Это один из самых простых и простых в установке решений на уровне программного обеспечения.

```shell
netstat -an | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -n
```

IP-адреса с предварительно настроенным количеством подключений автоматически блокируются в брандмауэре сервера, который может быть прямым ipfw, iptables или брандмауэром расширенной политики (APF). (Мы настоятельно рекомендуем использовать APF на вашем сервере в целом, но спуск будет работать без него.)

### Функции

* Можно переадресовывать IP-адреса, используя /etc/ddos/ignore.ip.list.
* Можно указывать имена хостов whitelist через /etc/ddos/ignore.host.list.
* Простой файл конфигурации: /etc/ddos/ddos.conf
* IP-адреса автоматически разблокируются после предварительно настроенного срока (по умолчанию: 600 секунд)
* Скрипт может работать как задание cron на выбранной частоте через файл конфигурации (по умолчанию: 1 минута)
* Скрипт может работать как демон на выбранной частоте через файл конфигурации (по умолчанию: 5 секунд)
* Вы можете получать оповещения по электронной почте, когда IP-адреса заблокированы.
* Блокировка управления по состоянию соединения (см. Man netstat).
* Автоматическое обнаружение брандмауэра.
* Поддержка APF, CSF, ipfw и iptables.
* Записывает события в /var/log/ddos.log
* Использует tcpkill, чтобы уменьшить количество процессов, открытых злоумышленниками.

## Установка

От имени пользователя root выполняем следующие команды:

```shell
git clone https://github.com/WoozyMasta/ddos-deflate.git
cd ddos-deflate
./install.sh
```

Зависимости:

```
nslookup netstat ifconfig tcpkill timeout awk sed grep
```

Могут ыть установлены автоматически

## Удаление

От имени пользователя root выполняем следующие команды:

```shell
cd ddos-deflate
./uninstall.sh
```

## Применение

Установщик автоматически обнаружит, поддерживает ли ваша система скрипты init.d, системные службы или задания cron. Если один из них найден, он установит файлы apropiate и запустит скрипт ddos. В случае init.d и systemd скрипт ddos запускается как демон, интервал мониторинга которого устанавливается по умолчанию в 5 секунд. Демон гораздо быстрее обнаруживает атаки, чем задание cron, поскольку cron's ограничены интервалом в 1 минуту.

После того, как вы установили hava (D) Dos deflate, измените конфигурационные файлы в соответствии с вашими потребностями.

**/etc/ddos/ignore.host.list**

В этом файле вы можете добавить список имен хостов для белого списка, пример:

> googlebot.com <br />
> my-dynamic-ip.somehost.com

**/etc/ddos/ignore.ip.list**

В этом файле вы можете добавить список адресов для белого списка, пример:

> 12.43.63.13 <br />
> 129.134.131.2

**/etc/ddos/ddos.conf**

Этот сценарий изменяет поведение сценария ddos. 
Подробнее см. ** man ddos **, который имеет документацию по различным параметрам конфигурации.

После изменения конфигурационных файлов вам необходимо перезапустить демон.
Если работаете на systemd:
> systemctl restart ddos

Если используеться класический init.d скрипт:

> /etc/init.d/ddos restart <br />
> или <br />
> service ddos restart

При запуске скрипта в качестве cronjob перезапуск не требуется.

## Использование CLI  

**ddos** [OPTIONS] [N]

*N : количество подключений tcp / udp (по умолчанию 150)*

#### ОПЦИИ

**-h | --help:**

    Показать экран справки.

**- c | --cron:**

    Создайте задание cron для регулярного запуска скрипта (по умолчанию 1 минута).

**-i | --ignore-list:**

    Список белых адресов ip.

**-b | --bans-list:**

    Список в настоящее время запретил IP-адреса.

**-d | --start:**

    Инициализация демона для мониторинга соединений.

**- s | --stop:**

    Остановите демона.

**- t | --status:**

    Показывать статус демона и pid, если он запущен.

**- v | --view:**

    Отображение активных подключений к серверу.

**- k | --kill:**

    Заблокируйте все IP-адреса, сделав более N соединений.
